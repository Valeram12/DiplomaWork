{% extends 'main/layout.html' %}
{% load static %}
{% block title %}
    SlideBase
{% endblock %}
{% block content %}
    {% if request.user.is_authenticated %}
        <div class="container mt-3">
        {% if page_obj %}

            {% if typeOfContent == 'database' %}
                <h1>Сторінка бази даних PresentationBase</h1>
                <br>
                <form action="{% url 'search_results' %}" method="get">
                    <div class="row">
                        <div class="col-5">
                            <div class="formdb border border-primary m-1">
                                <button>
                                    <svg width="17" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"
                                         role="img"
                                         aria-labelledby="search">
                                        <path d="M7.667 12.667A5.333 5.333 0 107.667 2a5.333 5.333 0 000 10.667zM14.334 14l-2.9-2.9"
                                              stroke="currentColor" stroke-width="1.333" stroke-linecap="round"
                                              stroke-linejoin="round"></path>
                                    </svg>
                                </button>
                                <input class="input" placeholder="Назва презентаціїї" type="text"
                                       name="title"
                                       id="title">
                                <button class="reset" onclick="resetInput(`title`)" type="button">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
                                         viewBox="0 0 24 24"
                                         stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                              d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                                <input type="hidden" name="search_type" value="title">
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="formdb  border border-primary m-1">
                                <button>
                                    <svg width="17" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"
                                         role="img"
                                         aria-labelledby="search">
                                        <path d="M7.667 12.667A5.333 5.333 0 107.667 2a5.333 5.333 0 000 10.667zM14.334 14l-2.9-2.9"
                                              stroke="currentColor" stroke-width="1.333" stroke-linecap="round"
                                              stroke-linejoin="round"></path>
                                    </svg>
                                </button>
                                <input class="input" placeholder="Автор" type="text" name="author"
                                       id="author">
                                <button class="reset" onclick="resetInput(`author`)" type="button">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
                                         viewBox="0 0 24 24"
                                         stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                              d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                                <input type="hidden" name="search_type" value="author">
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="formdb  border border-primary m-1">
                                <button>
                                    <svg width="17" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"
                                         role="img"
                                         aria-labelledby="search">
                                        <path d="M7.667 12.667A5.333 5.333 0 107.667 2a5.333 5.333 0 000 10.667zM14.334 14l-2.9-2.9"
                                              stroke="currentColor" stroke-width="1.333" stroke-linecap="round"
                                              stroke-linejoin="round"></path>
                                    </svg>
                                </button>
                                <input class="input" placeholder="Оцінка" type="text" name="rating"
                                       id="rating">
                                <button class="reset" onclick="resetInput(`rating`)" type="button">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
                                         viewBox="0 0 24 24"
                                         stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                              d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                                <input type="hidden" name="search_type" value="rating">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-4">
                            <div class="formdb  border border-primary m-1">
                                <button>
                                    <svg width="17" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"
                                         role="img"
                                         aria-labelledby="search">
                                        <path d="M7.667 12.667A5.333 5.333 0 107.667 2a5.333 5.333 0 000 10.667zM14.334 14l-2.9-2.9"
                                              stroke="currentColor" stroke-width="1.333" stroke-linecap="round"
                                              stroke-linejoin="round"></path>
                                    </svg>
                                </button>
                                <input class="input" placeholder="Вміст" type="text" name="group"
                                       id="group">
                                <button class="reset" onclick="resetInput(`group`)" type="button">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
                                         viewBox="0 0 24 24"
                                         stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                              d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                                <input type="hidden" name="search_type" value="group">
                            </div>
                        </div>
                        <div class="col-5">
                            <div class="formdb  border border-primary m-1">
                                <button>
                                    <svg width="17" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"
                                         role="img"
                                         aria-labelledby="search">
                                        <path d="M7.667 12.667A5.333 5.333 0 107.667 2a5.333 5.333 0 000 10.667zM14.334 14l-2.9-2.9"
                                              stroke="currentColor" stroke-width="1.333" stroke-linecap="round"
                                              stroke-linejoin="round"></path>
                                    </svg>
                                </button>
                                <input class="input" placeholder="Примітка" type="text" name="notes"
                                       id="notes">
                                <button class="reset" onclick="resetInput(`notes`)" type="button">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
                                         viewBox="0 0 24 24"
                                         stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                              d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                                <input type="hidden" name="search_type" value="notes">
                            </div>
                        </div>
                        <div class="col-2">
                            <div class="formdb  border border-primary m-1">
                                <button>
                                    <svg width="17" height="16" fill="none" xmlns="http://www.w3.org/2000/svg"
                                         role="img"
                                         aria-labelledby="search">
                                        <path d="M7.667 12.667A5.333 5.333 0 107.667 2a5.333 5.333 0 000 10.667zM14.334 14l-2.9-2.9"
                                              stroke="currentColor" stroke-width="1.333" stroke-linecap="round"
                                              stroke-linejoin="round"></path>
                                    </svg>
                                </button>
                                <input class="input" placeholder="Дата" type="text" name="time" id="time">
                                <button class="reset" onclick="resetInput(`time`)" type="button">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
                                         viewBox="0 0 24 24"
                                         stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                              d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                                <input type="hidden" name="search_type" value="time">
                            </div>
                        </div>
                        <div class="col-1">
                            <button class="btn btn-primary m-1 me-0 w-100 search-button" type="submit">
                                Пошук
                            </button>
                        </div>
                    </div>
                </form>
            {% elif typeOfContent == 'search' %}
                <h3>Результати пошуку</h3>
            {% endif %}
            <div class="table-responsive">
                <table class="table" id="table1">
                    <thead class="thead border-dark">
                    <tr>
                        <th>
                            {% if sort_by == 'title' %}
                                <a href="?{{ querystring }}&sort_by=-title">Назва презентації:▲</a>
                            {% elif sort_by == '-title' %}
                                <a href="?{{ querystring }}&sort_by=title">Назва презентації:▼</a>
                            {% else %}
                                <a href="?{{ querystring }}&sort_by=-title">Назва презентації:</a>
                            {% endif %}
                        </th>
                        <th>
                            {% if sort_by == 'author' %}
                                <a href="?{{ querystring }}&sort_by=-author">Автор:▲</a>
                            {% elif sort_by == '-author' %}
                                <a href="?{{ querystring }}&sort_by=author">Автор:▼</a>
                            {% else %}
                                <a href="?{{ querystring }}&sort_by=-author">Автор:</a>
                            {% endif %}
                        </th>
                        <th>
                            {% if sort_by == 'group' %}
                                <a href="?{{ querystring }}&sort_by=-group">Вміст:▲</a>
                            {% elif sort_by == '-group' %}
                                <a href="?{{ querystring }}&sort_by=group">Вміст:▼</a>
                            {% else %}
                                <a href="?{{ querystring }}&sort_by=-group">Вміст:</a>
                            {% endif %}
                        </th>
                        <th>
                            {% if sort_by == 'time' %}
                                <a href="?{{ querystring }}&sort_by=-time">Час завантаженя:▲</a>
                            {% elif sort_by == '-time' %}
                                <a href="?{{ querystring }}&sort_by=time">Час завантаженя:▼</a>
                            {% else %}
                                <a href="?{{ querystring }}&sort_by=-time">Час завантаженя:</a>
                            {% endif %}
                        </th>
                        <th>
                            {% if sort_by == 'notes' %}
                                <a href="?{{ querystring }}&sort_by=-notes">Примітка:▲</a>
                            {% elif sort_by == '-notes' %}
                                <a href="?{{ querystring }}&sort_by=notes">Примітка:▼</a>
                            {% else %}
                                <a href="?{{ querystring }}&sort_by=-notes">Примітка:</a>
                            {% endif %}
                        </th>
                        <th>
                            {% if sort_by == 'rating' %}
                                <a href="?{{ querystring }}&sort_by=-rating">Оцінка:▲</a>
                            {% elif sort_by == '-rating' %}
                                <a href="?{{ querystring }}&sort_by=rating">Оцінка:▼</a>
                            {% else %}
                                <a href="?{{ querystring }}&sort_by=-rating">Оцінка:</a>
                            {% endif %}
                        </th>

                        <th id="link" class="text-nowrap">Посилання на презентацію:</th>
                        <th colspan="2"></th>
                    </tr>
                    </thead>

                    {% for el in page_obj %}
                        <tr>
                            <td>{{ el.title }}</td>
                            <td>{{ el.author }}</td>
                            <td><textarea readonly>{{ el.group }} </textarea></td>
                            <td>{{ el.time }}</td>
                            <td> {{ el.notes }}</td>
                            <td>{{ el.rating }}</td>
                            {% if request.user.is_superuser or request.user.first_name == el.author.split.0 and request.user.last_name == el.author.split.1 %}
                                <td class="align-middle text-center"><a href="{% url 'link' el.id %}"
                                                                        class="btn btn-success btn-outline-light btn-floating"
                                                                        target="_blank"> Посилання</a>
                                </td>
                                <td class="align-middle text-center"><a href="{% url 'updatePr' el.id %}"
                                                                        class="btn btn-success btn-outline-light btn-floating"><i
                                        class="fa-regular fa-pen-to-square"></i></a></td>
                                <td class="align-middle text-center">
                                    <button data-id="{{ el.id }}"
                                            class="btn btn-success btn-outline-light btn-floating delete-btn"><i
                                            class="fa-regular fa-trash-can"></i></button>
                                    {% elif request.user.is_staff %}
                                <td class="align-middle text-center"><a href="{% url 'link' el.id %}"
                                                                        class="btn btn-success btn-outline-light btn-floating"
                                                                        target="_blank"> Посилання</a>
                                </td>
                                <td class="align-middle text-center"><a
                                        class="btn btn-warning btn-outline-light btn-floating"><i
                                        class="fa-regular fa-pen-to-square"></i></a></td>
                                <td class="align-middle text-center"><a
                                        class="btn btn-warning btn-outline-light btn-floating"><i
                                        class="fa-regular fa-trash-can"></i></a></td>
                            {% else %}
                                <td class="align-middle text-center"><a class="btn btn-warning "> Посилання</a></td>
                                <td class="align-middle text-center"><a
                                        class="btn btn-warning btn-outline-light btn-floating"><i
                                        class="fa-regular fa-pen-to-square"></i></a></td>
                                <td class="align-middle text-center"><a
                                        class="btn btn-warning btn-outline-light btn-floating"><i
                                        class="fa-regular fa-trash-can"></i></a></td>
                            {% endif %}

                        </tr>
                    {% endfor %}
                </table>
            </div>
            <div class="pagination d-flex justify-content-center mb-3">

                {% if page_obj.has_previous %}
                    <a href="?{{ querystring }}&sort_by={{ sort_by }}&page={{ page_obj.previous_page_number }}">&lt;</a>
                {% else %}
                    <a style="cursor: pointer">&lt;</a>
                {% endif %}

                {% if page_obj.number|add:'-2' > 1 %}
                    <a href="?{{ querystring }}&sort_by={{ sort_by }}&page=1">1</a>
                    <a href="?{{ querystring }}&sort_by={{ sort_by }}&page={{ page_obj.number|add:'-3' }}">&laquo;</a>
                {% endif %}

                {% for i in page_obj.paginator.page_range %}
                    {% if page_obj.number == i %}
                        <a href="?{{ querystring }}&sort_by={{ sort_by }}&page={{ i }}" class="active">{{ i }}</a>
                    {% elif i > page_obj.number|add:'-3' and i < page_obj.number|add:'3' %}
                        <a href="?{{ querystring }}&sort_by={{ sort_by }}&page={{ i }}">{{ i }}</a>
                    {% endif %}
                {% endfor %}

                {% if page_obj.paginator.num_pages > page_obj.number|add:'2' %}
                    <a href="?{{ querystring }}&sort_by={{ sort_by }}&page={{ page_obj.number|add:'3' }}">&raquo;</a>
                    <a href="?{{ querystring }}&sort_by={{ sort_by }}&page={{ page_obj.paginator.num_pages }}">{{ page_obj.paginator.num_pages }}</a>
                {% endif %}

                {% if page_obj.has_next %}
                    <a href="?{{ querystring }}&sort_by={{ sort_by }}&page={{ page_obj.next_page_number }}">&gt;</a>
                {% else %}
                    <a style="cursor: pointer">&gt;</a>
                {% endif %}

            </div>


        {% else %}
            <h3 class="m-5 text-center">Пошук не приніс результату або бази даних немає!</h3>
        {% endif %}
    {% else %}
        <div class="m-5 text-center"><h1>Ви не зареєстровані!</h1></div>


    {% endif %}

</div>





    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        $(document).ready(function () {
            $('.table-responsive').on('click', '.delete-btn', function () {
                let id = $(this).data('id');
                let url = 'delete/' + id;

                $.ajax({
                    type: 'POST',
                    url: url,
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                    },
                    success: function (data) {
                        $('.table-responsive').html($(data).find('.table-responsive').html());
                        $('.pagination').html($(data).find('.pagination').html());
                    },
                    error: function (xhr, status, error) {

                        console.error(error);
                    }
                });
            });
        });
    </script>
{% endblock %}